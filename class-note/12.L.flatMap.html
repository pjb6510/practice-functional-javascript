<body>
  <script src="../common/log.js"></script>
  <script src="../common//functions.js"></script>
  <script>
    titleLog("flatMap function");

    const arr = [
      [1, 2],
      [3, 4],
      [5, 6, 7],
    ];

    log(
      arr.flatMap(
        (innerArr) => (
          console.log("innerArr", innerArr), innerArr.map((n) => n ** 2)
        )
      )
    );
    // 기본 스펙으로 있는 flatMap.
    // map에는 객체가 들어오고 map 콜백에서 리턴한 배열을 flatten해줌

    const LFlatMap = _.curry(_.pipe(L.map, L.flatten));
    const flatMap = _.curry(_.pipe(L.map, _.flatten));

    const iter = L.flatMap((innerArr) => _.map((n) => n ** 2, innerArr), arr);
    const iter2 = _.flatMap((innerArr) => _.map((n) => n ** 2, innerArr), arr);
    log(...iter);
    log(...iter2);

    titleLog("flatMap example");

    log(flatMap(L.range, [1, 2, 3]));
    log(...LFlatMap(L.range, [1, 2, 3]));

    titleLog("2D-array example");

    const arr2 = [
      [1, 2],
      [3, 4, 5],
      [6, 7, 8],
      [9, 10],
    ];

    _.go(
      arr2,
      L.flatten,
      L.filter((n) => n % 2),
      L.map((n) => n ** 2),
      _.take(5),
      _.reduce((a, b) => a + b),
      log
    );

    const users = [
      {
        name: "a",
        age: 21,
        family: [
          { name: "a1", age: 53 },
          { name: "a2", age: 47 },
          { name: "a3", age: 16 },
          { name: "a4", age: 15 },
        ],
      },
      {
        name: "b",
        age: 24,
        family: [
          { name: "b1", age: 58 },
          { name: "b2", age: 51 },
          { name: "b3", age: 19 },
          { name: "b4", age: 22 },
        ],
      },
      {
        name: "c",
        age: 31,
        family: [
          { name: "c1", age: 64 },
          { name: "c2", age: 62 },
        ],
      },
      {
        name: "d",
        age: 20,
        family: [
          { name: "d1", age: 42 },
          { name: "d2", age: 42 },
          { name: "d3", age: 11 },
          { name: "d4", age: 7 },
        ],
      },
    ];


    // 가족들 중에서 미성년자들의 나이를 모두 구해서 더하라.
    _.go(
      users,
      L.flatMap((user) => user.family),
      L.filter((person) => person.age < 20),
      L.map((person) => person.age),
      _.reduce((a, b) => a + b),
      log
    );
  </script>
</body>
