<body>
  <script src="../common/log.js"></script>
  <script src="../common//functions.js"></script>
  <script>
    const products = [
      { name: "반팔티", price: 15000 },
      { name: "긴팔티", price: 20000 },
      { name: "핸드폰케이스", price: 15000 },
      { name: "후드티", price: 30000 },
      { name: "바지", price: 25000 },
    ];

    titleLog("중첩형 사고");
    titleLog("20000원 이하 상품 가격의 총합");
    log(
      _.reduce(
        (a, b) => a + b,
        _.filter(
          (price) => price <= 20000,
          _.map((product) => product.price, products)
        )
      )
    );

    // 함수형 프로그래밍의 특징
    // 함수를 중첩하고 연속적으로 실행해가면서 값을 만들어 감.
    // 읽기 안 좋음...

    titleLog("go function");

    // const go = (value, ...funcs) => {
    //   for (const func of funcs) {
    //     value = func(value);
    //   }
    // };

    const go = (...args) => _.reduce((val, func) => func(val), args);

    go(
      0,
      (a) => a + 1,
      (a) => a + 10,
      (a) => a + 100,
      log
    ); /// 111

    titleLog("pipe function");
    const pipe =
      (firstFunc, ...funcs) =>
      (...values) =>
        go(firstFunc(...values), ...funcs);

    const add111 = pipe(
      (a, b, c) => a + b + c,
      (a) => a + 10,
      (a) => a + 100
    );

    log(add111(0, 1, 2));

    titleLog("20000원 이하 상품 가격의 총합, go를 사용해서.");

    go(
      products,
      (products) => _.map((product) => product.price, products),
      (prices) => _.filter((price) => price <= 20000, prices),
      (prices) => _.reduce((acc, cur) => acc + cur, 0, prices),
      log
    );

    titleLog("curry function");
    const curryy =
      (func) =>
      (firstArg, ...restArgs) =>
        restArgs.length // 인자가 2개 이상이면 (즉, firstArg가 채워진 후 restArgs에 하나라도 들어오면)
          ? func(firstArg, ...restArgs) // 바로 실행.
          : (...restArgs) => func(firstArg, ...restArgs); // 2개 미만이면 이후에 인자로 받아서 실행.

    const mult = curryy((a, b) => a * b);
    log(mult(2, 3));

    const mult3 = mult(3);
    log(mult3(1));
    log(mult3(2));
    log(mult3(3));
    log(mult3(4));
    log(mult3(5));
    log(mult3(6));

    titleLog("20000원 이하 상품 가격의 총합, curry를 적용해서.");

    go(
      products,
      _.map((product) => product.price),
      _.filter((price) => price <= 20000),
      _.reduce((acc, cur) => acc + cur),
      log
    );

    titleLog("파이프라인으로 된 함수 중복코드 제거");

    go(
      products,
      _.filter((p) => p.price < 20000),
      _.map((p) => p.price),
      _.reduce((a, b) => a + b),
      log
    );

    go(
      products,
      _.filter((p) => p.price >= 20000),
      _.map((p) => p.price),
      _.reduce((a, b) => a + b),
      log
    );

    titleLog('addPrice');

    const addPrice = pipe(
      _.map((product) => product.price),
      _.reduce((a, b) => a + b)
    );

    go(
      products,
      _.filter((p) => p.price < 20000),
      addPrice,
      log,
    );

    go(
      products,
      _.filter((p) => p.price >= 20000),
      addPrice,
      log,
    );

    titleLog('addPriceWithFilter');

    const addPriceWithFilter = (filterCallback) => pipe(
      _.filter(filterCallback),
      addPrice,
    );

    go(
      products,
      addPriceWithFilter((p) => p.price >= 20000),
      log,
    );
  </script>
</body>
